<h2>Payvision Calculator</h2>

<div id="calculator" class="calculator">
  <button id="clear" class="clear">C</button>

  <div id="viewer" class="viewer">0</div>

  <button class="num" data-num="9">9</button>
  <button class="num" data-num="8">8</button>
  <button class="num" data-num="7">7</button>
  <button data-ops="plus" class="ops">+</button>

  <button class="num" data-num="4">4</button>
  <button class="num" data-num="5">5</button>
  <button class="num" data-num="6">6</button>
  <button data-ops="minus" class="ops">-</button>

  <button class="num" data-num="0">0</button>
  <button class="num" data-num="1">1</button>
  <button class="num" data-num="2">2</button>

  <button class="num" data-num="3">3</button>
  <button id="dot">.</button>
  <button id="equals" class="equals" data-result="">=</button>
  
  <button data-ops="multiply" class="ops">*</button>
  <button data-ops="divide" class="ops">%</button>
</div>

<style>
  body {
    background-color: #be3c50;
    font: 300 18px/1.6 "Source Sans Pro", sans-serif;
    margin: 0;
    padding: 5em 0 2em;
    text-align: center;
    color: rgb(200, 255, 225);
  }

  h2 {
    font-weight: 300;
    margin: 0;
  }

  .calculator {
    font-size: 28px;
    margin: 0 auto;
    width: 10em;
  }

  .calculator::before, .calculator::after {
    content: " ";
    display: table;
  }

  .calculator::after {
    clear: both;
  }

  .broken {
    animation: broken 2s;
    transform: translate3d(0, -2000px, 0);
    opacity: 0;
  }

  .viewer {
    float: left;
    line-height: 3em;
    text-align: right;
    text-overflow: ellipsis;
    overflow: hidden;
    width: 7.5em;
    height: 3em;
  }

  button {
    border: 0;
    background: rgba(42, 50, 113, 0.28);
    color: rgb(200, 255, 225);
    cursor: pointer;
    float: left;
    font: inherit;
    margin: 0.25em;
    width: 2em;
    height: 2em;
    transition: all 0.5s;
  }
</style>

<script>
  (function() {
    // Shortcuts to get elements
    const el = document.querySelector.bind(document);
    const els = document.querySelectorAll.bind(document);

    // Variables
    var viewer = el("#viewer"), // Calculator screen where result is displayed
      equals = el("#equals"), // Equal button
      nums = els(".num"), // List of numbers
      ops = els(".ops"), // List of operators
      clear = el("#clear"), // C button
      dot = el("#dot"), // Dot button
      calculator = el("#calculator"), // Full calculator
      writerNum = "", // Variable to store and simplify number adding
      currentNumDecimals = 0, // Number of decimals of current writing number
      oldNum = 0, // First number
      oldNumDecimals = 0, // Number of decimals of First number
      resultNum, // Result
      operator, // Batman
      dotPressed = false; 

    // When: Number is clicked. Get the current number selected
    var setNum = function() {
      if (resultNum) {
        // If a result was displayed, reset number
        writerNum = this.getAttribute("data-num");
        resultNum = 0;
        currentNumDecimals = 0;
      } else {
        writerNum += this.getAttribute("data-num");
      }
      if (dotPressed) currentNumDecimals++;

      viewer.innerHTML = writerNum; // Display current number
    };

    // When: Dot is clicked. Set dotpressed true
    var addDot = function() {
      if (!dotPressed) {
        if (resultNum) {
          writerNum = "0";
          resultNum = 0;
        }
        writerNum += ".";

        viewer.innerHTML = writerNum; // Display current number
        dotPressed = true;
      }
    }

    // When: Operator is clicked. Pass number to oldNum and save operator
    var moveNum = function() {
      oldNum = parseFloat(writerNum);
      oldNumDecimals = currentNumDecimals;
      currentNumDecimals = 0;

      writerNum = "";
      dotPressed = false;
      
      operator = this.getAttribute("data-ops");

      equals.setAttribute("data-result", ""); // Reset result in attr
    };

    // When: Equals is clicked. Calculate result
    var displayNum = function() {
      var theNum = parseFloat(writerNum);

      // We get decimal count to allow integer operations, 
      // which is safer than with floats
      const maxNumDecimals = Math.max(currentNumDecimals, oldNumDecimals);
      const powerOfTenSumOrSubtract = Math.pow(10, maxNumDecimals);

      const powerOfTenMultiplyOrDivide = Math.pow(10, currentNumDecimals + oldNumDecimals);

      // Perform operation
      switch (operator) {
        case "minus":
          resultNum = (oldNum * powerOfTenSumOrSubtract) - (theNum * powerOfTenSumOrSubtract);
          resultNum = resultNum / powerOfTenSumOrSubtract;
          break;

        case "plus":
          resultNum = (oldNum * powerOfTenSumOrSubtract) + (theNum * powerOfTenSumOrSubtract);
          resultNum = resultNum / powerOfTenSumOrSubtract;
          break;

        case "multiply":

          resultNum = oldNum * theNum * powerOfTenMultiplyOrDivide;
          resultNum = Math.round(resultNum) / powerOfTenMultiplyOrDivide;
          break;

        case "divide":
          resultNum = (oldNum / theNum) * powerOfTenMultiplyOrDivide;
          resultNum = Math.round(resultNum) / powerOfTenMultiplyOrDivide;
          break;

        // If equal is pressed without an operator, keep number and continue
        default:
          resultNum = theNumAsInteger;
      }


      // If NaN or Infinity returned
      if (!isFinite(resultNum)) {
        if (isNaN(resultNum)) {
          // If result is not a number; set off by, eg, double-clicking operators
          displayResult("You broke it!");
        } else {
          // If result is infinity, set off by dividing by zero
          displayResult("Look at what you've done");
          calculator.classList.add("broken"); // Break calculator
        }
      } else {
        // Display result, finally!
        displayResult(resultNum);
      }

      // Now reset oldNum & keep result
      oldNum = 0;
      oldNumDecimals = 0;
      writerNum = resultNum.toString();
      dotPressed = false;
    };

    // When: Clear button is pressed. Clear everything
    var clearAll = function() {
      oldNum = 0;
      oldNumDecimals = 0;
      writerNum = "";
      dotPressed = false;

      displayResult(0);
    };

    // Private helper to set result where is needed
    function displayResult(result) {
      viewer.innerHTML = result;
      equals.setAttribute("data-result", result);
    }

    /* The click events */

    // Add click event to numbers
    for (var i = 0, l = nums.length; i < l; i++) {
      nums[i].onclick = setNum;
    }

    // Add click event to operators
    for (var i = 0, l = ops.length; i < l; i++) {
      ops[i].onclick = moveNum;
    }

    // Add click event to equal sign
    equals.onclick = displayNum;

    // Add click event to clear button
    clear.onclick = clearAll;

    // Add click event to dot button
    dot.onclick = addDot;
  })();
</script>
